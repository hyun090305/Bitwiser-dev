<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=0.7, maximum-scale=1, user-scalable=no">
    <title>Bitwiser</title>
    <link rel="stylesheet" href="style.css">
    <style>
    html {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
  </style>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap"
      rel="stylesheet" />
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <meta name="description" content="ë…¼ë¦¬ íšŒë¡œ í¼ì¦ ê²Œì„ - ë¸”ë¡ì„ ì¡°í•©í•´ íšŒë¡œë¥¼ êµ¬í˜„í•˜ì„¸ìš”!">
    <meta property="og:title" content="Bitwiser">
    <meta property="og:description" content="ë…¼ë¦¬ íšŒë¡œ í¼ì¦ ê²Œì„ - ë¸”ë¡ì„ ì¡°í•©í•´ íšŒë¡œë¥¼ êµ¬í˜„í•˜ì„¸ìš”!">
    <meta property="og:image" content="https://hyun090305.github.io/Bitwiser/assets/icon-512.png">
  </head>
  <body>
    <canvas id="backgroundCanvas"></canvas>
    <div id="loadingScreen">
      <div class="loader"></div>
      <p id="loadingText">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
    <div id="usernameModal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2 id="loginTitle"></h2>
        <button id="modalGoogleLoginBtn" class="btn-primary" style="margin-bottom:1rem;"></button>
        <p class="info-text" id="loginInfo"></p>
        <input type="text" id="usernameInput" />
        <div id="usernameError" style="color:red; margin-top:0.5rem;"></div>
        <button id="usernameSubmit"></button>
      </div>
    </div>
    <div id="mergeModal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2 id="mergeTitle">ì§„í–‰ ìƒí™© ë³‘í•©</h2>
        <div id="mergeDetails">
          <p id="mergeMessage">í˜„ì¬ ë¡œì»¬ ì§„í–‰ ìƒí™©ì„ Google ê³„ì •ê³¼ ë³‘í•©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
        </div>
        <div class="modal-buttons">
          <button id="mergeConfirmBtn">ë„¤</button>
          <button id="mergeCancelBtn">ì œ ê³„ì •ì´ ì•„ë‹™ë‹ˆë‹¤</button>
        </div>
      </div>
    </div>
    <div id="shareModal" class="modal" style="display:none;">
          <div class="modal-content">
            <h3 id="shareTitle">ğŸ”— ê³µìœ í•  ë‚´ìš©</h3>
            <textarea id="shareText" readonly rows="20"
              style="width:100%;"></textarea>
            <div style="margin-top:1rem; text-align:right;">
              <button id="copyShareBtn">ë³µì‚¬í•˜ê¸°</button>
              <button id="closeShareBtn">ë‹«ê¸°</button>
            </div>
          </div>
        </div>
    <div id="orientationModal" class="modal" style="display:none;">
      <div class="modal-content">
        <p id="orientationWarningText"></p>
        <p id="orientationTipText"></p>
        <div class="modal-buttons">
          <button id="closeOrientationBtn"></button>
        </div>
      </div>
    </div>
    <div id="settingsModal" class="modal" style="display:none;">
      <div class="modal-content settings-modal">
        <h3 id="settingsTitle"></h3>
        <div class="settings-section">
          <label class="settings-checkbox">
            <input type="checkbox" id="autoSaveCheckbox">
            <span id="autoSaveLabel"></span>
          </label>
          <label class="settings-checkbox">
            <input type="checkbox" id="backgroundAnimationCheckbox">
            <span id="backgroundAnimationLabel"></span>
          </label>
        </div>
        <div class="settings-section">
          <div class="settings-section__header">
            <h4 id="themeHeading"></h4>
          </div>
          <div id="themeOptions" class="theme-options"></div>
          <div class="theme-preview">
            <div class="theme-preview__canvas">
              <canvas id="themePreviewCanvas" width="158" height="158"></canvas>
              <p id="themePreviewLabel"></p>
            </div>
            <p id="themeDescription" class="theme-description"></p>
          </div>
        </div>
        <div class="modal-buttons">
          <button id="settingsCloseBtn"></button>
        </div>
      </div>
    </div>
    <!-- ë©”ì¸ í™”ë©´ -->
    <div class="container" id="firstScreen">
      <div id="overallRankingArea" class="tab-screen">
        <h3 id="overallRankingTitle">ğŸ† ì „ì²´ ë­í‚¹</h3>
        <div id="overallRankingList">ë¡œë”© ì¤‘â€¦</div>
      </div>
      <div id="mainArea" class="tab-screen active">
        <div id="mainScreen">
        <h1>ğŸ§  Bitwiser</h1>
        <p class="tagline" id="mainTagline"></p>
        <div class="button-row">
          <button id="labBtn" class="main-button icon-button" type="button" aria-label="ì‹¤í—˜ì‹¤" title="ì‹¤í—˜ì‹¤">ğŸ”¬</button>
          <button id="chapterNavBtn" class="main-button icon-button" type="button" aria-label="ìŠ¤í…Œì´ì§€ ì„ íƒ" title="ìŠ¤í…Œì´ì§€ ì„ íƒ">â–¶</button>
          <button id="userProblemsBtn" class="main-button icon-button" type="button" aria-label="ì‚¬ìš©ì ë¬¸ì œ" title="ì‚¬ìš©ì ë¬¸ì œ">âš’ï¸</button>
        </div>
        <div class="button-row">
          <button id="tutorialBtn" class="main-button">íŠœí† ë¦¬ì–¼</button>
          <button id="copyStatusBtn" class="main-button">ê³µìœ í•˜ê¸°</button>
        </div>
        </div>
        <div id="loginArea">
          <h2 id="loginUsername"></h2>
          <div id="rankSection" style="display:none;">
            <table id="rankTable">
              <tr>
                <td class="rank-cell">
                  <p id="loginRankOverallLabel" class="rank-label"></p>
                  <p id="overallRank" class="rank-value">#-</p>
                </td>
                <td class="rank-cell">
                  <p id="loginRankClearedLabel" class="rank-label"></p>
                  <p id="clearedCount" class="rank-value">0</p>
                </td>
              </tr>
            </table>
          </div>
          <div class="button-row">
            <button id="googleLoginBtn" class="main-button"></button>
            <button id="settingsBtn" class="main-button"></button>
          </div>
          <p id="loginGuestPrompt" class="tagline"></p>
          <div class="button-row">
            <button id="languageBtn" class="main-button"></button>
          </div>
        </div>
      </div>
      <div id="guestbookArea" class="tab-screen">
        <div id="guestbookForm">
          <h3 id="guestbookTitle">ğŸ“ ê°œë°œì(ì´í˜„ì¤€)í•œí…Œ ê¸€ ë‚¨ê¸°ê¸°</h3>
          <p class="info-text" id="guestNicknameLabel">ë‹‰ë„¤ì„: <b id="guestUsername"></b></p>
          <br>
          <textarea id="guestMessage" rows="4"
            placeholder="ë‚¨ê¸°ê³  ì‹¶ì€ ë§..."></textarea>
          <br>
          <button id="guestSubmitBtn" onclick="submitGuestEntry()">ë“±ë¡</button>
        </div>
        <div id="guestbookListArea">
          <div id="guestbookList"></div>
          <button id="coffeeBtn">
            â˜• ê°œë°œì(ì´í˜„ì¤€)í•œí…Œ ì»¤í”¼ ì‚¬ì£¼ê¸°
          </button>
        </div>
      </div>
      <div id="mobileNav" role="tablist">
        <div class="nav-item" data-target="overallRankingArea" role="tab" aria-selected="false">
          <img id="mobileNavRankingIcon" src="assets/trophy-icon.png" alt="" class="nav-icon">
          <span class="nav-text" id="mobileNavRankingText"></span>
        </div>
        <div class="nav-item active" data-target="mainArea" role="tab" aria-selected="true">
          <img id="mobileNavHomeIcon" src="assets/home-icon.png" alt="" class="nav-icon">
          <span class="nav-text" id="mobileNavHomeText"></span>
        </div>
        <div class="nav-item" data-target="guestbookArea" role="tab" aria-selected="false">
          <img id="mobileNavGuestbookIcon" src="assets/message-icon.png" alt="" class="nav-icon">
          <span class="nav-text" id="mobileNavGuestbookText"></span>
        </div>
      </div>
    </div>

    <div id="labScreen" style="display:none;">
      <div id="labCanvasContainer">
        <canvas id="labBgCanvas"></canvas>
        <canvas id="labContentCanvas"></canvas>
        <canvas id="labOverlayCanvas"></canvas>
      </div>
      <button id="labExitBtn" class="lab-exit-btn" type="button" aria-label=""></button>
    </div>

    <div
      id="communityShareOverlay"
      class="community-overlay"
      role="dialog"
      aria-modal="true"
      aria-labelledby="communityShareTitleLabel"
      data-open="false"
    >
      <div class="community-overlay__panel community-share">
        <button id="communityShareClose" class="community-overlay__close" type="button" aria-label="">Ã—</button>
        <h2 id="communityShareTitleLabel" class="community-share__title"></h2>
        <p class="community-share__intro" id="communityShareIntro"></p>
        <p id="communityShareStats" class="community-share__stats"></p>
        <form id="communityShareForm" class="community-share__form">
          <label for="communityShareTitle" id="communityShareTitleFieldLabel" class="community-share__label"></label>
          <input
            id="communityShareTitle"
            name="communityShareTitle"
            type="text"
            maxlength="80"
            placeholder=""
            class="community-share__input"
          >
          <label for="communityShareDescription" id="communityShareDescriptionLabel" class="community-share__label"></label>
          <textarea
            id="communityShareDescription"
            name="communityShareDescription"
            rows="3"
            maxlength="300"
            placeholder=""
            class="community-share__textarea"
          ></textarea>
          <p id="communityShareStatus" class="community-share__status" role="status" aria-live="polite"></p>
          <div class="community-share__actions">
            <button id="communityShareCancel" type="button" class="community-button community-button--ghost"></button>
            <button id="communityShareSubmit" type="submit" class="community-button community-button--primary"></button>
          </div>
        </form>
      </div>
    </div>

    <div
      id="communityBrowserOverlay"
      class="community-overlay"
      role="dialog"
      aria-modal="true"
      aria-labelledby="communityBrowserTitle"
      data-open="false"
    >
      <div class="community-overlay__panel community-browser">
        <div class="community-browser__header">
          <h2 id="communityBrowserTitle"></h2>
          <button id="communityBrowserClose" class="community-overlay__close" type="button" aria-label="">Ã—</button>
        </div>
        <p id="communityBrowserStatus" class="community-browser__status" role="status" aria-live="polite"></p>
        <div id="communityLoading" class="community-browser__loading" hidden></div>
        <div id="communityEmptyState" class="community-browser__empty" hidden></div>
        <div id="communityList" class="community-browser__list"></div>
      </div>
    </div>

    <div id="problem-screen" class="screen" style="display:none;">
      <div class="panel-overlay problem-screen-panel">
        <div id="problemCanvasContainer" class="problem-grid-container" style="position:relative;margin:auto;">
          <canvas id="problemBgCanvas" style="position:relative;"></canvas>
          <canvas id="problemContentCanvas"></canvas>
          <canvas id="problemOverlayCanvas"></canvas>
        </div>
        <div class="rightPanel" id="problemRightPanel" style="display:flex; flex-direction:column; gap:0.5rem; margin: auto 0;">
          <h1 id="problemCreatorTitle">ğŸ“ ë¬¸ì œ ì¶œì œ</h1>
          <div class="edit-toolbar" role="toolbar" aria-label="íšŒë¡œ ë³µì‚¬ ë° ë¶™ì—¬ë„£ê¸°" hidden>
            <button
              id="problemCopySelectionBtn"
              class="toolbar__button has-tooltip"
              type="button"
              data-tooltip="ì„ íƒ ì˜ì—­ ë³µì‚¬ (C)"
              aria-label="ì„ íƒ ì˜ì—­ ë³µì‚¬ (C)"
              hidden
              disabled
            >
              <img src="assets/icon_copy.svg" alt="" class="toolbar__icon" />
            </button>
            <button
              id="problemPasteSelectionBtn"
              class="toolbar__button has-tooltip"
              type="button"
              data-tooltip="ì„ íƒ ì˜ì—­ ë¶™ì—¬ë„£ê¸° (V)"
              aria-label="ì„ íƒ ì˜ì—­ ë¶™ì—¬ë„£ê¸° (V)"
              hidden
              disabled
            >
              <img src="assets/icon_paste.svg" alt="" class="toolbar__icon" />
            </button>
          </div>
          <section class="panel-section" aria-labelledby="gridSizeControllerLabel">
            <h2 id="gridSizeControllerLabel" class="panel-section__title">ğŸ§­ Grid Size</h2>
            <div class="grid-size-controller" id="problemGridSizeController">
              <button
                id="addRowTopBtn"
                type="button"
                class="grid-size-controller__button grid-size-controller__button--expand grid-size-controller__button--top-outer"
                data-grid-action="add-row-top"
                aria-label="ìœ„ìª½ í–‰ ì¶”ê°€"
              >
                <span aria-hidden="true">â†‘</span>
              </button>
              <button
                id="removeRowTopBtn"
                type="button"
                class="grid-size-controller__button grid-size-controller__button--shrink grid-size-controller__button--top-inner"
                data-grid-action="remove-row-top"
                aria-label="ìœ„ìª½ í–‰ ì œê±°"
              >
                <span aria-hidden="true">â†“</span>
              </button>
              <button
                id="addRowBottomBtn"
                type="button"
                class="grid-size-controller__button grid-size-controller__button--expand grid-size-controller__button--bottom-outer"
                data-grid-action="add-row-bottom"
                aria-label="ì•„ë˜ìª½ í–‰ ì¶”ê°€"
              >
                <span aria-hidden="true">â†“</span>
              </button>
              <button
                id="removeRowBottomBtn"
                type="button"
                class="grid-size-controller__button grid-size-controller__button--shrink grid-size-controller__button--bottom-inner"
                data-grid-action="remove-row-bottom"
                aria-label="ì•„ë˜ìª½ í–‰ ì œê±°"
              >
                <span aria-hidden="true">â†‘</span>
              </button>
              <button
                id="addColLeftBtn"
                type="button"
                class="grid-size-controller__button grid-size-controller__button--expand grid-size-controller__button--left-outer"
                data-grid-action="add-col-left"
                aria-label="ì™¼ìª½ ì—´ ì¶”ê°€"
              >
                <span aria-hidden="true">â†</span>
              </button>
              <button
                id="removeColLeftBtn"
                type="button"
                class="grid-size-controller__button grid-size-controller__button--shrink grid-size-controller__button--left-inner"
                data-grid-action="remove-col-left"
                aria-label="ì™¼ìª½ ì—´ ì œê±°"
              >
                <span aria-hidden="true">â†’</span>
              </button>
              <button
                id="addColRightBtn"
                type="button"
                class="grid-size-controller__button grid-size-controller__button--expand grid-size-controller__button--right-outer"
                data-grid-action="add-col-right"
                aria-label="ì˜¤ë¥¸ìª½ ì—´ ì¶”ê°€"
              >
                <span aria-hidden="true">â†’</span>
              </button>
              <button
                id="removeColRightBtn"
                type="button"
                class="grid-size-controller__button grid-size-controller__button--shrink grid-size-controller__button--right-inner"
                data-grid-action="remove-col-right"
                aria-label="ì˜¤ë¥¸ìª½ ì—´ ì œê±°"
              >
                <span aria-hidden="true">â†</span>
              </button>
              <div class="grid-size-controller__preview" id="gridSizePreview" aria-live="polite">
                <span id="gridSizePreviewValue">0Ã—0</span>
              </div>
            </div>
          </section>
          <div style="display:flex; justify-content:space-between; gap:1rem;">
            <div style="display:flex; flex-direction:column; align-items:center; gap:0.5rem; margin:auto;">
              <div class="status-toolbar" role="toolbar" aria-label="íšŒë¡œ í¸ì§‘ ë‹¨ì¶•í‚¤ ì•ˆë‚´">
                <button id="problemWireMoveInfo" class="status-toolbar__button has-tooltip" type="button"
                  data-tooltip="ê¸°ë³¸ ìƒíƒœ" aria-label="ê¸°ë³¸ ìƒíƒœ">
                  <img src="assets/icon_move.svg" alt="" class="status-toolbar__icon">
                </button>
                <button id="problemWireStatusInfo" class="status-toolbar__button has-tooltip" type="button"
                  data-tooltip="Ctrl / Cmd - ë„ì„  ê·¸ë¦¬ê¸°" aria-label="Ctrl / Cmd - ë„ì„  ê·¸ë¦¬ê¸°">
                  <img src="assets/icon_draw.svg" alt="" class="status-toolbar__icon">
                </button>
                <button id="problemWireDeleteInfo" class="status-toolbar__button has-tooltip" type="button"
                  data-tooltip="Shift - ë„ì„ /ë¸”ë¡ ì‚­ì œ" aria-label="Shift - ë„ì„ /ë¸”ë¡ ì‚­ì œ">
                  <img src="assets/icon_delete.svg" alt="" class="status-toolbar__icon">
                </button>
                <button id="problemWireSelectInfo" class="status-toolbar__button has-tooltip" type="button"
                  data-tooltip="ë§ˆìš°ìŠ¤ ì˜¤ë¥¸ìª½ - ì„ íƒ" aria-label="ë§ˆìš°ìŠ¤ ì˜¤ë¥¸ìª½ - ì„ íƒ">
                  <img src="assets/icon_select.svg" alt="" class="status-toolbar__icon">
                </button>
                <button id="problemDeleteAllInfo" class="status-toolbar__button has-tooltip" type="button"
                  data-tooltip="R - íšŒë¡œ ì´ˆê¸°í™”" aria-label="R - íšŒë¡œ ì´ˆê¸°í™”">
                  <img src="assets/icon_reset.svg" alt="" class="status-toolbar__icon">
                </button>
              </div>
              <div class="history-toolbar" role="group" aria-label="ë˜ëŒë¦¬ê¸° ë° ë‹¤ì‹œ ì‹¤í–‰">
                <button
                  id="problemUndoBtn"
                  class="status-toolbar__button has-tooltip"
                  type="button"
                  data-tooltip="ë˜ëŒë¦¬ê¸° (Z)"
                  aria-label="ë˜ëŒë¦¬ê¸° (Z)"
                  disabled
                >
                  <img src="assets/icon_undo.svg" alt="" class="status-toolbar__icon">
                </button>
                <button
                  id="problemRedoBtn"
                  class="status-toolbar__button has-tooltip"
                  type="button"
                  data-tooltip="ë‹¤ì‹œ ì‹¤í–‰ (Y)"
                  aria-label="ë‹¤ì‹œ ì‹¤í–‰ (Y)"
                  disabled
                >
                  <img src="assets/icon_redo.svg" alt="" class="status-toolbar__icon">
                </button>
              </div>
              <div id="problemUsageSection" style="width:100%;">
                <table id="problemUsageTable">
                  <tr>
                    <td class="rank-cell">
                      <p id="problemUsedBlocksLabel" class="rank-label"></p>
                      <p id="problemUsedBlocks" class="rank-value">0</p>
                    </td>
                    <td class="rank-cell">
                      <p id="problemUsedWiresLabel" class="rank-label"></p>
                      <p id="problemUsedWires" class="rank-value">0</p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
          <div style="margin-top:0.5rem; text-align:center;">
            <button id="backToMainFromProblem" class="btn-back">â† ë©”ì¸ìœ¼ë¡œ</button>
            <button id="saveProblemBtn" class="btn-back" style="margin-left:20px;">ë¬¸ì œ ì €ì¥</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ë¬¸ì œ ì €ì¥ ëª¨ë‹¬ -->
    <div id="problemSaveModal" class="modal" style="display:none;">
      <div class="modal-backdrop"></div>
      <div class="modal-dialog">
        <h3 id="problemInfoTitle">ë¬¸ì œ ì •ë³´ ì…ë ¥</h3>
        <input id="problemTitleInput" type="text" placeholder="ë¬¸ì œ ì œëª©" class="modal-input" />
        <textarea id="problemDescInput" rows="3" placeholder="ë¬¸ì œ ì„¤ëª…" class="modal-textarea"></textarea>
        <div class="difficulty-row">
          <span id="problemDifficultyLabel">ë‚œì´ë„</span>
          <div id="problemDifficultyStars" class="difficulty-stars" role="radiogroup" aria-labelledby="problemDifficultyLabel">
            <button type="button" class="difficulty-star" data-value="1" role="radio" aria-checked="false" aria-label="ë‚œì´ë„ 1">â˜…</button>
            <button type="button" class="difficulty-star" data-value="2" role="radio" aria-checked="false" aria-label="ë‚œì´ë„ 2">â˜…</button>
            <button type="button" class="difficulty-star" data-value="3" role="radio" aria-checked="false" aria-label="ë‚œì´ë„ 3">â˜…</button>
            <button type="button" class="difficulty-star" data-value="4" role="radio" aria-checked="false" aria-label="ë‚œì´ë„ 4">â˜…</button>
            <button type="button" class="difficulty-star" data-value="5" role="radio" aria-checked="false" aria-label="ë‚œì´ë„ 5">â˜…</button>
          </div>
          <span id="problemDifficultyValueLabel" class="difficulty-value"></span>
          <input type="hidden" id="problemDifficultyValue" value="3" />
        </div>
        <label>
          <input type="checkbox" id="fixIOCheck">
          <span id="fixIOCheckLabel">IN/OUT ìœ„ì¹˜ ê³ ì •</span>
        </label>
        <div class="modal-buttons">
          <button id="confirmSaveProblemBtn" class="btn-primary">ì €ì¥í•˜ê¸°</button>
          <button id="cancelSaveProblemBtn" class="btn-secondary">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>

    <div id="chapterStageScreen" style="display:none; padding: 2rem;">
      <h1 id="chapterTitle">ğŸ“š ìŠ¤í…Œì´ì§€ ì„ íƒ</h1>
      <div id="chapterStageContainer">
        <div id="chapterList" class="chapter-list"></div>
        <div id="stagePanel">
          <div id="stageList" class="stage-list"></div>
        </div>
      </div>
      <button id="backToMainFromChapter" class="btn-back">â† ë©”ì¸ìœ¼ë¡œ</button>
      <button id="toggleChapterList" class="btn-toggle" style='display: none'>â˜°</button>
    </div>
    <div id="user-problems-screen" class="screen" style="display:none;">
      <div class="panel-overlay user-problems-panel">
        <div class="user-problems-content">
          <div class="user-problems-sidebar">
            <h1 id="userProblemsTitle">ğŸ“ ì‚¬ìš©ì ë¬¸ì œ</h1>
            <p id="userProblemsSubtitle" class="user-problems-subtitle"></p>
            <div class="user-problems-toolbar" role="region" aria-labelledby="userProblemsTitle">
              <div class="user-problems-toolbar-row">
                <label id="userProblemSearchLabel" class="sr-only" for="userProblemSearch">ê²€ìƒ‰</label>
                <div class="user-problems-search">
                  <span aria-hidden="true">ğŸ”</span>
                  <input id="userProblemSearch" type="search" placeholder="ì œëª© ë˜ëŠ” from:ì œì‘ì" autocomplete="off" spellcheck="false" />
                </div>
                <div class="user-problems-sort">
                  <label id="userProblemSortLabel" for="userProblemSort">ì •ë ¬</label>
                  <select id="userProblemSort" aria-labelledby="userProblemSortLabel">
                    <option id="userProblemSortLatestOption" value="latest">ìµœì‹ ìˆœ</option>
                    <option id="userProblemSortPopularOption" value="popular">ì¸ê¸°ìˆœ</option>
                    <option id="userProblemSortSolvedOption" value="solved">í•´ê²°ìˆœ</option>
                    <option id="userProblemSortDifficultyOption" value="difficulty">ë‚œì´ë„ìˆœ</option>
                    <option id="userProblemSortNameOption" value="name">ì´ë¦„ìˆœ</option>
                  </select>
                </div>
              </div>
              <div class="user-problems-filter-row" role="group" aria-label="ì‚¬ìš©ì ë¬¸ì œ í•„í„°">
                <button type="button" class="user-problem-filter-toggle" data-user-problem-toggle="onlyMine" aria-pressed="false">
                  ğŸ§‘â€ğŸ’» <span id="userProblemFilterMine">ë‚˜ì˜ ë¬¸ì œ</span>
                </button>
                <button type="button" class="user-problem-filter-toggle" data-user-problem-toggle="onlyUnsolved" aria-pressed="false">
                  ğŸ§© <span id="userProblemFilterUnsolved">ë¯¸í•´ê²°</span>
                </button>
                <button type="button" class="user-problem-filter-toggle" data-user-problem-toggle="onlyPopular" aria-pressed="false">
                  â™¥ <span id="userProblemFilterPopular">ì¸ê¸°</span>
                </button>
                <div class="user-problem-difficulty-group" role="group" aria-label="ë‚œì´ë„">
                  <button
                    type="button"
                    class="user-problem-filter-toggle user-problem-difficulty-toggle"
                    data-user-problem-difficulty="1"
                    aria-pressed="true"
                  >
                    â­ 1
                  </button>
                  <button
                    type="button"
                    class="user-problem-filter-toggle user-problem-difficulty-toggle"
                    data-user-problem-difficulty="2"
                    aria-pressed="true"
                  >
                    â­â­ 2
                  </button>
                  <button
                    type="button"
                    class="user-problem-filter-toggle user-problem-difficulty-toggle"
                    data-user-problem-difficulty="3"
                    aria-pressed="true"
                  >
                    â­â­â­ 3
                  </button>
                  <button
                    type="button"
                    class="user-problem-filter-toggle user-problem-difficulty-toggle"
                    data-user-problem-difficulty="4"
                    aria-pressed="true"
                  >
                    â­â­â­â­ 4
                  </button>
                  <button
                    type="button"
                    class="user-problem-filter-toggle user-problem-difficulty-toggle"
                    data-user-problem-difficulty="5"
                    aria-pressed="true"
                  >
                    â­â­â­â­â­ 5
                  </button>
                </div>
              </div>
              <div id="userProblemResultSummary" class="user-problem-result-summary"></div>
            </div>
            <div class="user-problems-actions">
              <button id="openProblemCreatorBtn" class="btn-primary">ë¬¸ì œ ë§Œë“¤ê¸°</button>
              <button id="backToChapterFromUserProblems" class="btn-back user-problems-back">â† ë©”ì¸ìœ¼ë¡œ</button>
            </div>
          </div>
          <div class="user-problems-list-container">
            <ul id="userProblemList" class="problem-list"></ul>
          </div>
        </div>
      </div>
    </div>
    <div id="rankingModal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2 id="rankingTitle">ğŸ† ë­í‚¹</h2>
        <div id="rankingList"></div>
      </div>
    </div>
    <div id="hintModal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2 id="hintTitle">ğŸ’¡ íŒíŠ¸</h2>
        <div id="hintButtons" class="modal-buttons" style="flex-wrap:wrap; margin-bottom:1rem; justify-content:center;"></div>
        <div id="hintTimerContainer" class="modal-buttons" style="justify-content:center; margin-bottom:1rem;">
          <span id="nextHintTimer"></span>
          <button id="adHintBtn">ê´‘ê³  ë³´ê³  íŒíŠ¸ ì–»ê¸°</button>
        </div>
        <div class="modal-buttons">
          <button id="closeHintBtn">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
    <div id="hintMessageModal" class="modal" style="display:none;">
      <div class="modal-content">
        <div id="hintMessage" style="margin-bottom:1rem;"></div>
        <div class="modal-buttons">
          <button id="closeHintMessageBtn">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
    <!-- ê²Œì„ í™”ë©´ -->
    <div id="gameScreen" style="display:none">
      <div id="gameArea">

        <!-- ì „ì²´ ê²Œì„ ì˜ì—­: ì¢Œì¸¡ ë©”ë‰´ + ì¤‘ì•™ ê·¸ë¦¬ë“œ + ìš°ì¸¡ ì•ˆë‚´ -->
        <div id="gameLayout">

          <div id="canvasContainer" style="position: relative;">
          <canvas id="bgCanvas" style="position: relative;"></canvas>
          <canvas id="contentCanvas"></canvas>
          <canvas id="overlayCanvas"></canvas>
          <div id="gridOverlay"></div>
        </div>

        <!-- ìš°ì¸¡: ì‹œë®¬ë ˆì´íŠ¸ + ì•ˆë‚´ + ì‚­ì œ -->
        <div class="rightPanel" id="rightPanel"
          style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
          <h1 id="gameTitle" title="â„¹ï¸ ìŠ¤í…Œì´ì§€ ì•ˆë‚´">ğŸ§  Bitwiser</h1>
          <button id="gradeButton" class="main-button">ì±„ì í•˜ê¸°</button>
          <div class="edit-toolbar" role="toolbar" aria-label="íšŒë¡œ ë³µì‚¬ ë° ë¶™ì—¬ë„£ê¸°" hidden>
            <button
              id="copySelectionBtn"
              class="toolbar__button has-tooltip"
              type="button"
              data-tooltip="ì„ íƒ ì˜ì—­ ë³µì‚¬ (C)"
              aria-label="ì„ íƒ ì˜ì—­ ë³µì‚¬ (C)"
              hidden
              disabled
            >
              <img src="assets/icon_copy.svg" alt="" class="toolbar__icon" />
            </button>
            <button
              id="pasteSelectionBtn"
              class="toolbar__button has-tooltip"
              type="button"
              data-tooltip="ì„ íƒ ì˜ì—­ ë¶™ì—¬ë„£ê¸° (V)"
              aria-label="ì„ íƒ ì˜ì—­ ë¶™ì—¬ë„£ê¸° (V)"
              hidden
              disabled
            >
              <img src="assets/icon_paste.svg" alt="" class="toolbar__icon" />
            </button>
          </div>
          <div class="status-toolbar" role="toolbar" aria-label="íšŒë¡œ í¸ì§‘ ë‹¨ì¶•í‚¤ ì•ˆë‚´">
            <button id="wireMoveInfo" class="status-toolbar__button has-tooltip" type="button"
              data-tooltip="ê¸°ë³¸ ìƒíƒœ" aria-label="ê¸°ë³¸ ìƒíƒœ">
              <img src="assets/icon_move.svg" alt="" class="status-toolbar__icon">
            </button>
            <button id="wireStatusInfo" class="status-toolbar__button has-tooltip" type="button"
              data-tooltip="Ctrl / Cmd - ë„ì„  ê·¸ë¦¬ê¸°" aria-label="Ctrl / Cmd - ë„ì„  ê·¸ë¦¬ê¸°">
              <img src="assets/icon_draw.svg" alt="" class="status-toolbar__icon">
            </button>
            <button id="wireDeleteInfo" class="status-toolbar__button has-tooltip" type="button"
              data-tooltip="Shift - ë„ì„ /ë¸”ë¡ ì‚­ì œ" aria-label="Shift - ë„ì„ /ë¸”ë¡ ì‚­ì œ">
              <img src="assets/icon_delete.svg" alt="" class="status-toolbar__icon">
            </button>
            <button id="wireSelectInfo" class="status-toolbar__button has-tooltip" type="button"
              data-tooltip="ë§ˆìš°ìŠ¤ ì˜¤ë¥¸ìª½ - ì„ íƒ" aria-label="ë§ˆìš°ìŠ¤ ì˜¤ë¥¸ìª½ - ì„ íƒ">
              <img src="assets/icon_select.svg" alt="" class="status-toolbar__icon">
            </button>
            <button id="DeleteAllInfo" class="status-toolbar__button has-tooltip" type="button"
              data-tooltip="R - íšŒë¡œ ì´ˆê¸°í™”" aria-label="R - íšŒë¡œ ì´ˆê¸°í™”">
              <img src="assets/icon_reset.svg" alt="" class="status-toolbar__icon">
            </button>
          </div>
          <div class="history-toolbar" role="group" aria-label="ë˜ëŒë¦¬ê¸° ë° ë‹¤ì‹œ ì‹¤í–‰">
            <button
              id="undoBtn"
              class="status-toolbar__button has-tooltip"
              type="button"
              data-tooltip="ë˜ëŒë¦¬ê¸° (Z)"
              aria-label="ë˜ëŒë¦¬ê¸° (Z)"
              disabled
            >
              <img src="assets/icon_undo.svg" alt="" class="status-toolbar__icon">
            </button>
            <button
              id="redoBtn"
              class="status-toolbar__button has-tooltip"
              type="button"
              data-tooltip="ë‹¤ì‹œ ì‹¤í–‰ (Y)"
              aria-label="ë‹¤ì‹œ ì‹¤í–‰ (Y)"
              disabled
            >
              <img src="assets/icon_redo.svg" alt="" class="status-toolbar__icon">
            </button>
          </div>
          <div id="usageSection" style="width:100%;">
            <table id="usageTable">
              <tr>
                <td class="rank-cell">
                  <p id="usedBlocksLabel" class="rank-label"></p>
                  <p id="usedBlocks" class="rank-value">0</p>
                </td>
                <td class="rank-cell">
                  <p id="usedWiresLabel" class="rank-label"></p>
                  <p id="usedWires" class="rank-value">0</p>
                </td>
              </tr>
            </table>
          </div>
          <div id="labCommunityControls" class="lab-community-controls" style="display:none;">
            <h2 class="lab-community-title" id="labCommunityTitle"></h2>
            <button id="labShareCommunityBtn" class="main-button" type="button" style="width:auto;"></button>
            <button id="labOpenCommunityBtn" class="main-button" type="button" style="width:auto;"></button>
            <p id="labCommunityStatus" class="lab-community-status" role="status" aria-live="polite"></p>
            <p id="labCommunityLoginHint" class="lab-community-hint" hidden></p>
          </div>
        </div>
        <div id="gradingArea" style="display:none">
          <button id="returnToEditBtn">ğŸ›  í¸ì§‘ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
      </div>
      <div id="circuitError"></div>
      </div>
      <!-- ë©”ë‰´ë°” -->
      <div id="menuBar">
        <button id="menuToggleBtn">â˜°</button>
        <button id="saveCircuitBtn">ğŸ’¾ íšŒë¡œ ì €ì¥</button>
        <button id="viewSavedBtn">ğŸ’¾ ì €ì¥ëœ íšŒë¡œ</button>
        <button id="viewRankingBtn">ğŸ† ë­í‚¹</button>
        <button id="showIntroBtn">â„¹ï¸ ìŠ¤í…Œì´ì§€ ì•ˆë‚´</button>
        <button id="hintBtn">ğŸ’¡ íŒíŠ¸</button>
        <button id="exportGifBtn">ğŸ“· íšŒë¡œ ë‚´ë³´ë‚´ê¸°</button>
        <button id="prevStageBtnMenu">â† ì´ì „ ìŠ¤í…Œì´ì§€</button>
        <button id="nextStageBtnMenu">ë‹¤ìŒ ìŠ¤í…Œì´ì§€ â†’</button>
        <button id="backToLevelsBtn">â† ë ˆë²¨ ì„ íƒìœ¼ë¡œ</button>
      </div>
    </div>
    <div id="tutorialModal" class="modal tutorial-modal" style="display:none;">
      <div class="modal-content tutorial-content">
        <h2 id="tutTitle"></h2>
        <!-- ì—¬ê¸° ì´ë¯¸ì§€ ìë¦¬ -->
        <img id="tutImg" class="tutorial-img" src alt="íŠœí† ë¦¬ì–¼ ì´ë¯¸ì§€"
          style="display:none;">
        <p id="tutDesc"></p>
        <div class="tut-controls">
          <button id="tutPrevBtn">ì´ì „</button>
          <button id="tutNextBtn">ë‹¤ìŒ</button>
          <button id="tutFinishBtn" style="display:none;">íŠœí† ë¦¬ì–¼ ë§ˆì¹˜ê¸°</button>
          <button id="tutCloseBtn">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
    <!-- ì €ì¥ëœ íšŒë¡œ ëª©ë¡ ëª¨ë‹¬ -->
    <div id="savedModal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2 id="savedListTitle">ğŸ’¾ ì €ì¥ëœ íšŒë¡œ ëª©ë¡</h2>
        <div id="savedList" class="saved-list"
          style="display:flex; flex-wrap:wrap; gap:10px; max-height:300px; overflow-y:auto;">
          <!-- ì—¬ê¸°ì— JSë¡œ í•­ëª©ë“¤ì´ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
        </div>
        <div style="text-align:right; margin-top:1rem;">
          <button id="closeSavedModal">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
    <!-- ë¬¸ì œ ëª©ë¡ ëª¨ë‹¬ -->
    <div id="problemListModal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2 id="problemListTitle">ğŸ“‚ ì €ì¥ëœ ë¬¸ì œ</h2>
        <ul id="problemList" style="list-style:none; padding:0; max-height:300px; overflow-y:auto;"></ul>
        <div style="text-align:right; margin-top:1rem;">
          <button id="closeProblemListModal">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
    <!-- GIF ê²°ê³¼ ëª¨ë‹¬ -->
    <div id="gifModal" class="modal" style="display:none;">
      <div class="modal-content">
        <img id="gifPreview" style="max-width:100%; height:60vh;" />
        <div class="modal-buttons" style="margin-top:1rem;">
          <button id="saveGifBtn">ì´ë¯¸ì§€ ì €ì¥</button>
          <button id="copyGifBtn" style="display:none">ì´ë¯¸ì§€ ë³µì‚¬</button>
          <button id="shareGifBtn">ê³µìœ í•˜ê¸°</button>
          <button id="closeGifModal">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
    <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>
    <div id="clearedModal" class="modal" style="display: none;">
      <div class="modal-content">
        <h2 id="clearedTitle">ìŠ¤í…Œì´ì§€ <span id="clearedStageNumber"></span> í´ë¦¬ì–´!</h2>
        <div id="clearedRanking"></div>
        <div class="modal-buttons">
          <button id="prevStageBtn">ì´ì „ ìŠ¤í…Œì´ì§€</button>
          <button id="nextStageBtn">ë‹¤ìŒ ìŠ¤í…Œì´ì§€</button>
        </div>
        <button class="closeBtn">&times;</button>
      </div>
    </div>
    <script
      src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script
      src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script
      src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script
      src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAbpyXETtBChmh6vKpHCyaqpmPIm-lzAkI",
      authDomain: "bitgame-70394.firebaseapp.com",
      databaseURL: "https://bitgame-70394-default-rtdb.firebaseio.com",
      projectId: "bitgame-70394",
      storageBucket: "bitgame-70394.firebasestorage.app",
      messagingSenderId: "796428704868",
      appId: "1:796428704868:web:6926c5650bec88ee0c1371",
      measurementId: "G-W7KQ98LNST"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const firestore = firebase.firestore();
  </script>
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="lang.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>
    <script src="background.js"></script>
    <script type="module" src="src/main.js"></script>

    <div id="levelIntroModal" style="display:none" class="modal">
      <div class="modal-content">
        <h2 id="introTitle"></h2>
        <p id="introDesc"></p>
        <div id="truthTableContainer">
          <table id="truthTable" border="1"></table>
        </div>
        <button id="startLevelBtn">ì‹œì‘í•˜ê¸°</button>
      </div>
    </div>
    <div id="stageTutorialModal" class="modal" style="display:none;">
      <div class="modal-content">
        <img id="stageTutImg" class="tutorial-img" src="" alt="tutorial">
        <div class="tutorial-text" style="font-size: 1.1rem">
          <p id="stageTutDesc"></p>
          <button id="stageTutBtn" class="main-button">ì‹œì‘í•˜ê¸°</button>
        </div>
      </div>
    </div>
    <script>
      (function () {
        let lastTouchEnd = 0;

        document.addEventListener(
          "touchend",
          function (event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
              event.preventDefault();
            }
            lastTouchEnd = now;
          },
          { passive: false }
        );

        document.addEventListener("gesturestart", function (event) {
          event.preventDefault();
        });
      })();
    </script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker.register("service-worker.js");
        });
      }
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6190035827461805"
     crossorigin="anonymous"></script>

  </body>
</html>
